## 热更新原理
主要是通过websocket实现，建立本地服务和浏览器的双向通信。当代码变化，重新编译后，通知浏览器请求更新的模块，替换原有的模块

1） 通过webpack-dev-server开启server服务，本地 server 启动之后，再去启动 websocket 服务，建立本地服务和浏览器的双向通信

2） webpack 每次编译后，会生成一个Hash值，Hash值 是每一次编译的标识。本次新生成的文件会以上一次的 Hash 值作为文件名标识

3） webpack 通过监听文件的生成时间来判断文件是否有变化，当文件变化后，重新编译

4）编译结束后，通知浏览器请求变化的资源，同时将新生成的 hash 值传给浏览器，用于下次热更新使用

5）浏览器拿到更新后的模块后，用新模块替换掉旧的模块，实现局部刷新



## Plugin 插件
webpack 的插件是依靠 webpack 的钩子函数实现的
webpack 在编译过代码程中，会触发一系列 Tapable 钩子函数，插件只需要在相应的钩子函数上注册事件，当webpack构建的时候，插件注册的事件就会随着钩子函数的触发而执行

### 插件的实现
1）Plugin 的本质是一个 node 模块，这个模块导出一个 JavaScript 类 或者 JavaScript 方法
2）它的原型上需要定义一个apply 的方法
3）通过 compiler 在钩子函数上注册事件
4）通过 compilation 操作 webpack 内部实例特定数据
5）功能完成后，执行 webpack 提供的 cb 回调

### 自定义一个名为MyPlugin插件，该插件在打包完成后，在控制台输出"打包已完成"
```javaScript
class MyPlugin {
  // 原型上需要定义apply 的方法
  apply(compiler) {
    // 通过compiler获取webpack内部的钩子
    compiler.hooks.done.tap('My Plugin', (compilation, cb) => {
      console.log('打包已完成');
      // 分为同步和异步的钩子，异步钩子必须执行对应的回调
    });
  }
}
module.exports = MyPlugin;
```

### 开发一个打包文件清单插件,将清单写入一个新的md文件中
```javaScript
class FileListPlugin {
  constructor (options) {
    // 获取插件配置项
      this.filename = options && options.filename ? options.filename : 'FILELIST.md';
  }

  apply(compiler) {
      // 注册 compiler 上的 emit 钩子
      compiler.hooks.emit.tapAsync('FileListPlugin', (compilation, cb) => {
          
          // 通过 compilation.assets 获取文件数量
          let len = Object.keys(compilation.assets).length;

          // 添加统计信息
          let content = `# ${len} file${len>1?'s':''} emitted by webpack\n\n`;

          // 通过 compilation.assets 获取文件名列表
          for(let filename in compilation.assets) {
              content += `- ${filename}\n`;
          }

          // 往 compilation.assets 中添加清单文件
          compilation.assets[this.filename] = {
            // 写入新文件的内容
              source: function() {
                  return content;
              },
              // 新文件大小（给 webapck 输出展示用）
              size: function() {
                  return content.length;
              }
          }

          // 执行回调，让 webpack 继续执行
          cb();
      })
  }
}

module.exports = FileListPlugin;
```